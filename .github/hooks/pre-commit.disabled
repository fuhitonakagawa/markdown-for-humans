#!/bin/bash
#
# Git pre-commit hook
# Automatically fixes linting issues and checks for remaining problems
#
# This hook runs automatically before every 'git commit'
#
# STATUS: DISABLED - Rename to pre-commit and run npm run install-hooks to enable
#

set -e

# ANSI color codes
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
CYAN='\033[0;36m'
RESET='\033[0m'

echo ""
echo -e "${CYAN}┌────────────────────────────────────────────────────────────────┐${RESET}"
echo -e "${CYAN}│${RESET}  ${GREEN}Running Pre-Commit Checks${RESET}                              ${CYAN}│${RESET}"
echo -e "${CYAN}└────────────────────────────────────────────────────────────────┘${RESET}"
echo ""

# Get project root (parent of .git directory)
PROJECT_ROOT="$(git rev-parse --show-toplevel)"
cd "$PROJECT_ROOT"

# Step 1: Auto-fix linting issues
echo -e "${CYAN}Step 1:${RESET} Auto-fixing linting issues..."
if npm run lint:fix > /dev/null 2>&1; then
  echo -e "  ${GREEN}✓${RESET} Auto-fixed linting issues"
else
  echo -e "  ${YELLOW}⚠${RESET} Some issues could not be auto-fixed"
fi

# Step 2: Check for remaining linting issues
echo -e "${CYAN}Step 2:${RESET} Checking for remaining linting issues..."
if npm run lint > /dev/null 2>&1; then
  echo -e "  ${GREEN}✓${RESET} All linting checks passed"
  echo ""
  exit 0
else
  echo ""
  echo -e "${RED}┌────────────────────────────────────────────────────────────────┐${RESET}"
  echo -e "${RED}│${RESET}  ${RED}❌ LINTING FAILED${RESET}                                          ${RED}│${RESET}"
  echo -e "${RED}├────────────────────────────────────────────────────────────────┤${RESET}"
  echo -e "${RED}│${RESET}                                                                ${RED}│${RESET}"
  echo -e "${RED}│${RESET}  There are linting errors that need to be fixed manually.      ${RED}│${RESET}"
  echo -e "${RED}│${RESET}                                                                ${RED}│${RESET}"
  echo -e "${RED}│${RESET}  Run: ${CYAN}npm run lint${RESET} to see the errors              ${RED}│${RESET}"
  echo -e "${RED}│${RESET}  Run: ${CYAN}npm run lint:fix${RESET} to auto-fix what's possible  ${RED}│${RESET}"
  echo -e "${RED}│${RESET}                                                                ${RED}│${RESET}"
  echo -e "${RED}│${RESET}  To skip this check (not recommended): ${YELLOW}git commit --no-verify${RESET} ${RED}│${RESET}"
  echo -e "${RED}└────────────────────────────────────────────────────────────────┘${RESET}"
  echo ""
  
  # Show the actual linting errors
  npm run lint
  exit 1
fi
